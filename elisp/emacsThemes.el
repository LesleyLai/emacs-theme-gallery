(setThemeAndTakeScreenshots)

(defun setThemeAndTakeScreenshots ()
  (let ((themes '((adwaita nil "native")
		  (ample t "https://github.com/jordonbiondo/ample-theme")
		  (ample-light nil "https://github.com/jordonbiondo/ample-theme")
		  (deeper-blue t "native")
		  (dichromacy nil "native")
		  (light-blue nil "native")
		  (manoj-dark t "native")
		  (misterioso t "native")
		  (monokai t "https://github.com/oneKelvinSmith/monokai-emacs")
		  (tango nil "native")
		  (tango-dark t "native")
		  (tsdh-dark t "native")
		  (tsdh-light nil "native")
		  (wheatgrass t "native")
		  (whiteboard nil "native")
		  (wombat t "native"))))
;		  (zenburn t))))

    (with-temp-buffer 
      (insert "var emacsThemesGallery = {};\n")
      (insert "emacsThemesGallery.themeProperties = {};\n")
      (insert "emacsThemesGallery.themeProperties.themes = [\n")
      (dolist (theme themes)
	(load-theme (car theme) t)
	(save-current-buffer
	  (takeThemeScreenshots (symbol-name (car theme)) (if (nth 1 theme) "dark" "light"))
	  (disable-theme (car theme)))
	(insert (concat "{ name: '" (symbol-name (car theme))
			"', dark: " (if (nth 1 theme) "true" "false")
			", location: '" (nth 2 theme) "' },\n")))
      (delete-char -2)
      (insert "\n];")
      (write-region nil nil "../scripts/themeProperties.js"))))

(defun takeThemeScreenshots (themeName color)
  "Creates screenshots for current theme"
  (let* ((screenShotDir (concat "../screenshots/" color))
	 (screenShotThemeDir (concat screenShotDir "/" themeName "/"))
	 (sourceFilesAbsolute (directory-files "../languageTemplates" t))
	 (scrotCommand (concat "scrot -q 100 -u " screenShotThemeDir)))

    (unless (file-exists-p screenShotDir)
      (make-directory screenShotDir))
    (unless (file-exists-p screenShotThemeDir)
      (make-directory screenShotThemeDir)
      (dolist (sourceFileAbsolute sourceFilesAbsolute)
	(let* ((sourceFileExtension (file-name-extension sourceFileAbsolute))
	       (screenShotName (concat sourceFileExtension ".png"))
	       (takeScreenshot (concat scrotCommand screenShotName))
	       (pathToScreenshot (concat screenShotThemeDir screenShotName)))
	  (find-file sourceFileAbsolute)
	  (sit-for 1)
	  (shell-command takeScreenshot)
	  (shell-command (concat "convert -crop 316x209+0+21 " pathToScreenshot " " pathToScreenshot))
	  (sit-for 1))))))
